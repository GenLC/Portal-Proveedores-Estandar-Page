sap.ui.define(["sap/ui/core/mvc/Controller","sap/m/MessageToast","sap/m/Dialog","sap/m/Button","../Encryption/aes"],function(e,s,o,t){"use strict";return e.extend("ppe.ppe.controller.Login",{onInit:function(){this.getView().byId("user").setValue("P1000");this.getView().byId("password").setValue("P1000Pass");var e="/b1s/v2/Login";jQuery.ajax({url:e,dataType:"json",success:function(e){localStorage.setItem("SessionId",e.SessionId);this.getView().getModel("LoginModel").setProperty("/SessionId",e.SessionId)}.bind(this),error:function(){this.getView().getModel("LoginModel").setProperty("/SessionId","")}.bind(this)})},onLogin:function(){let e=localStorage.getItem("SessionId");try{if(e){sap.m.MessageToast.show("Iniciando Sesion...",{duration:1e4});let e=this.getView().byId("user").getValue();let o=d(e,this.getView().byId("password").getValue());var s="/b1s/v2/BusinessPartners?$filter=CardCode eq '"+e+"' and U_Password_Portal eq '"+o+"'"+" and CardType eq 'cSupplier'";jQuery.ajax({url:s,dataType:"json",success:function(e){if(e.value[0]!=undefined){this.getView().getModel("LoginModel").setProperty("/Logged",true);this.getView().getModel("LoginModel").setProperty("/UserData",e.value[0]);u(e.value[0].PayTermsGrpCode,this);localStorage.setItem("UserLoged",e.value[0].CardCode);sap.m.MessageToast.show("Exito");this.getOwnerComponent().getRouter().getTargets().display("TargetMenu")}else{sap.m.MessageToast.show("Combinación de Usuario y Contraseña incorrecta",{duration:1e4})}}.bind(this),error:function(e){this.getView().getModel("LoginModel").setProperty("/Logged",false);console.log(JSON.stringify(e));sap.m.MessageToast.show("Error en la consulta "+JSON.stringify(e))}.bind(this)})}else{this.getView().getModel("LoginModel").setProperty("/Logged",false);sap.m.MessageToast.show("Error de sesión")}}catch(e){this.getView().getModel("LoginModel").setProperty("/Logged",false);console.log(e);sap.m.MessageToast.show("error conexion "+e)}}});function n(){debugger;let e={Name:"Password_Portal",Type:"db_Alpha",Size:100,Description:"udf Supplier portal password",SubType:"st_None",TableName:"OCRD"};var s="/b1s/v2/UserFieldsMD";jQuery.ajax({url:s,type:"POST",dataType:"json",data:JSON.stringify(e),success:function(e){debugger;console.log(e)}.bind(this),error:function(e){debugger;console.log(e)}.bind(this)})}function r(){debugger;let e={U_PassPortal:"test1pass"};var s="/b1s/v2/BusinessPartners('test1cardcode')";jQuery.ajax({url:s,type:"PATCH",dataType:"json",data:JSON.stringify(e),success:function(e){debugger;console.log(e)}.bind(this),error:function(e){debugger;console.log(e)}.bind(this)})}function a(){debugger;var e="/b1s/v2/UserFieldsMD(TableName='OCRD', FieldID=10)";jQuery.ajax({url:e,type:"DELETE",dataType:"json",success:function(e){debugger;console.log(e)}.bind(this),error:function(e){debugger;console.log(e)}.bind(this)})}function i(e,s){debugger;let o=d(e,s);let t={U_Password_Portal:o.toString()};console.log(t);var n="/b1s/v2/BusinessPartners('"+e+"')";jQuery.ajax({url:n,type:"PATCH",dataType:"json",data:JSON.stringify(t),success:function(e){debugger;console.log(e)}.bind(this),error:function(e){debugger;console.log(e)}.bind(this)})}function d(e,s){var o=s;var t=e;var n=CryptoJS.AES.encrypt(o,t);var r=CryptoJS.AES.decrypt(n,t);return r}function g(e){return e.toString(CryptoJS.enc.Utf8)}function l(){if(document.cookie==""){document.cookie="username=B1SESSION; content=60fd392a-e047-11ec-8000-16de22d6cf68; path=/b1s/v2";location.reload()}}function u(e,s){var o="/b1s/v2/PaymentTermsTypes("+e+")";jQuery.ajax({url:o,dataType:"json",data:{},success:function(e){if(e!=undefined){s.getView().getModel("LoginModel").setProperty("/UserData/PaymentTerms",e)}else{sap.m.MessageToast.show("cant find PaymentTermsTypes")}}.bind(s),error:function(e){console.log(JSON.stringify(e));sap.m.MessageToast.show("error en la consulta "+e)}.bind(s)})}function c(e){var s="/b1s/v2/WTaxTypeCodes("+GroupNumber+")";jQuery.ajax({url:s,dataType:"json",data:{},success:function(e){if(e!=undefined){_this.getView().getModel("LoginModel").setProperty("/UserData/WTaxTypeCodes",e)}else{sap.m.MessageToast.show("cant find PaymentTermsTypes")}}.bind(_this),error:function(e){console.log(JSON.stringify(e));sap.m.MessageToast.show("error en la consulta "+e)}.bind(_this)})}function p(){debugger;console.log(window.location.href)}});window.onkeyup=function(e){var s=e.keyCode?e.keyCode:e.which;if(s==83){let e=document.cookie;console.log(e)}};